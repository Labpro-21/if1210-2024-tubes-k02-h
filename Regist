import os

def read_csv(file_name): 
    data = []
    file_path = f"{file_name}.csv" 

    if os.path.exists(file_path):
        with open(file_path, 'r') as csvfile:
            for line in csvfile:
                # Remove leading/trailing whitespace (optional)
                line = line.strip()
                entry = []
                field = ''
                for char in line:
                    if char != ',':
                        field += char
                    else:
                        entry.append(field)
                        field = ''
                entry.append(field) 
                data.append(entry)
    return data

def check_valid(username): 
    acceptable_chars = set('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-')
    return all(char in acceptable_chars for char in username)  # One-line check

def register():
    username = input("Masukkan Username: ")
    password = input("Masukkan Password: ")

    if not check_valid(username):
        print("Username tidak valid, hanya mengandung huruf, angka, _, dan -")
        return

    users_data = read_csv("user")
    for entry in users_data:
        if entry[0] == username:  # Cek username
            print("Username sudah terdaftar. Silakan gunakan username lain.")
            return

    
    user_id = len(users_data)
    coins = 0  # Use plural form for consistency

    with open('user.csv', 'a') as f:
        f.write(f"{user_id};{username};{password};agent;{coins}\n")

    print("Registrasi berhasil.")
    print("Silakan pilih salah satu monster sebagai monster awalmu.")
    print("1. Charizard")
    print("2. Bulbasaur")
    print("3. Aspal")

    monster_choice = input("\n Monster pilihanmu: ")
    if monster_choice == "1":
        monster = "Charizard"
    elif monster_choice == "2":
        monster = "Bulbasaur"
    elif monster_choice == "3":
        monster = "Aspal"
    else:
        monster = "Tidak ada"
    print(f"\nSelamat datang Agent {username}. Mari kita mengalahkan Dr. Asep Spakbor dengan {monster}!")

register()
